<?php
    // Set up page title:
    $this->headTitle($this->translate('Statistics'));

    // Set up breadcrumbs:
    $this->layout()->breadcrumbs = '<li><a href="'.$this->url('myresearch-home').'">'.$this->transEsc('Your Account').'</a></li>' 
    							  .'<li class="active">' . $this->transEsc('Statistics') . '</li>';
    
    echo $this->render('statistics/menu.phtml');
    
    echo $this->render('statistics/calendar.phtml');
?>
<?php 
/*
 echo "<pre>";
 print_r($this->visitsInTime);
 echo "</pre>";
 */
?>

<div class="row">
	<div class="col-lg-12">
		<div class="panel panel-default">
		    <div class="panel-heading">
		        <h3 class="panel-title">
		            <i class="fa fa-clock-o fa-fw"></i>
		             <?= $this->transEsc('Visits in time') ?>
		        </h3>
		    </div>
		    <div class="panel-body">
		    	<div id="visits-in-time"></div>
		    </div>
		</div>
	</div>
</div>



				<div class="row">
                    <div class="col-lg-4">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">
                                	<i class="fa fa-user fa-fw"></i>
                                	<?= $this->transEsc('Visitors') ?>
                                </h3>
                            </div>
                            <div class="panel-body">
                                <div id="visits-comparision"></div>
                                <div class="text-right">
                                    <a href="<?php echo $this->url('statistics-visits') ?>"><?php echo $this->transEsc('View Details'); ?> 
                                    <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title"><i class="fa fa-search fa-fw"></i> <?php echo $this->transEsc('Top keywords'); ?> </h3>
                            </div>
                            <div class="panel-body">
                                <div class="table-responsive">
    								<table class="table table-hover table-striped">
       	 								<thead>
            								<tr>
            									<th>
            										<?= $this->transEsc('Search term') ?>
            									</th>
            									<th>
            										<?= $this->transEsc('Search count') ?>
            									</th>
            								</tr>
            							</thead>
            							<tbody>
            								<tr>
            									<td>
            										Slovo
            									</td>
            									<td>
            										15
            									</td>
            								</tr>
            								<tr>
            									<td>
            										Slovo
            									</td>
            									<td>
            										15
            									</td>
            								</tr>
            								<tr>
            									<td>
            										Slovo
            									</td>
            									<td>
            										15
            									</td>
            								</tr>
            								<tr>
            									<td>
            										Slovo
            									</td>
            									<td>
            										15
            									</td>
            								</tr>
            								<tr>
            									<td>
            										Slovo
            									</td>
            									<td>
            										15
            									</td>
            								</tr>
            								<tr>
            									<td>
            										Slovo
            									</td>
            									<td>
            										15
            									</td>
            								</tr>
            								<tr>
            									<td>
            										Slovo
            									</td>
            									<td>
            										15
            									</td>
            								</tr>
            							</tbody>
            						</table>
            					</div>
                                <div class="text-right">
                                    <a href="#"><?php echo $this->transEsc('View Details'); ?> <i class="fa fa-arrow-circle-right"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title"><i class="fa fa-users fa-fw"></i> Dashboard</h3>
                            </div>
                            <div class="panel-body">
                                <div class="table-responsive">
							        <table class="table">
							            <tbody>
							                <tr>
							                    <td>
							                        <button class="btn btn-danger m-r-sm" type="button">150</button>
													<?= $this->transEsc('Total visits') ?>
							 					</td>
							 				</tr>
							 				<tr>
							                    <td>
							                        <button class="btn btn-info m-r-sm" type="button">8:03</button>
													<?= $this->transEsc('Average visit time???') ?>
							 					</td>
							 				</tr>
							 				<tr>
							                    <td>
							                        <button class="btn btn-warning m-r-sm" type="button">12</button>
													<?= $this->transEsc('Actions per visit???') ?>
							 					</td>
							 				</tr>
							 				<tr>
							                    <td>
							                        <button class="btn btn-success m-r-sm" type="button">12</button>
													<?= $this->transEsc('Online borrowers') ?>
							 					</td>
							 				</tr>
							 				<tr>
							                    <td>
							                        <button class="btn btn-primary m-r-sm" type="button">245</button>
													<?= $this->transEsc('Searches') ?>
							 					</td>
							 				</tr>
							 				<tr>
							                    <td>
							                        <button class="btn btn-default m-r-sm" type="button">315</button>
													<?= $this->transEsc('Viewed records') ?>
							 					</td>
							 				</tr>
							 			</tbody>
							 		</table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.row -->

<script src="js/raphael.min.js"></script>
<script src="vendor/jquery.min.js"></script>
<script src="js/morris-0.4.1.min.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script>
	jQuery( document ).ready( function( $ ) {

		// Initializes donut chart for visitors comparision
	    Morris.Donut( {
	        element: 'visits-comparision',
	        data: [
	        	{ label: "<?php echo $this->transEsc('Returning readers'); ?>", value: <?= $this->returningVisitorsCount ?> },
			    { label: "<?php echo $this->transEsc('New readers'); ?>", value: <?= $this->newVisitorsCount ?> },
			],
	        resize: true
	    });

	 	// Initializes area chart for visits in time
	    Morris.Area( {
	        element: 'visits-in-time',
	        data: [
	   	    	<?php 
	   	    		$data = "";
	   	    		foreach ($this->visitsInTime as $key => $value) {
						$data .= "{ period: '$key', novi: ".$value["newVisits"].", vracejici: ".$value["returningVisits"]." },";
	   	    		}	   
	   	    		echo rtrim($data, ",");	   
				?>
	        ],
	        xkey: 'period',
	        ykeys: [ 'novi', 'vracejici' ],
	        labels: [ '<?php echo $this->transEsc('New readers'); ?>', '<?php echo $this->transEsc('Returning readers'); ?>' ],
	        pointSize: 2,
	        hideHover: 'auto'
	      });

	 	// Sets menu item as active
		$( ".statistics-dashboard" ).addClass( "active" );
		
	});
</script>

